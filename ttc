#!/usr/bin/env python3

import os
import sys
import argparse
import tiktoken

def token_count(filename, model):
    try:
        with open(filename, 'r') as f:
            content = f.read()
    except IOError as e:
        print(f"Error: {e}")
        return None

    encoding = tiktoken.encoding_for_model(model)
    return len(encoding.encode(content))

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Count tokens in files.')
    parser.add_argument('-m', '--model', default='gpt-4', help='TikToken model name (default: gpt-4)')
    parser.add_argument('files', metavar='FILE', nargs='+', help='Files to process')
    args = parser.parse_args()

    total = 0
    file_count = 0

    for filename in args.files:
        count = token_count(filename, args.model)
        if count is not None:
            print(f"{count:8} {filename}")
            total += count
            file_count += 1

    if file_count > 1:
        print(f"{total:8} total")
